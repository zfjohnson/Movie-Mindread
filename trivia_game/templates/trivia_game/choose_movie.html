{% extends 'trivia_game/base.html' %}
{% load static %}

{% block title %}Movie Mindread - Choose Movie{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h2 class="mb-0">Choose a Movie</h2>
                </div>
                <div class="card-body">
                    <div class="list-group">
                        {% for movie in movies %}
                        <div class="movie-item mb-3">
                            <div class="list-group-item list-group-item-action movie-header" 
                                 onclick="toggleMovieDetails({{ movie.id }})">
                                <div class="d-flex w-100 justify-content-between">
                                    <h5 class="mb-1">{{ movie.title }}</h5>
                                    <small>{{ movie.release_date }}</small>
                                </div>
                                <p class="mb-1">Director: {{ movie.director.name }}</p>
                                <small>Genre: {{ movie.genre }}</small>
                            </div>
                            <div id="movie-details-{{ movie.id }}" class="movie-details collapse">
                                <div class="card card-body border-0">
                                    <div class="movie-info mb-3">
                                        <h6>Movie Details:</h6>
                                        <ul class="list-unstyled">
                                            <li><strong>Title:</strong> {{ movie.title }}</li>
                                            <li><strong>Release Date:</strong> {{ movie.release_date }}</li>
                                            <li><strong>Director:</strong> {{ movie.director.name }}</li>
                                            <li><strong>Genre:</strong> {{ movie.genre }}</li>
                                            <li><strong>IMDB Rating:</strong> {{ movie.imdb_rating }}</li>
                                            <li><strong>Studio:</strong> {{ movie.studio.name }}</li>
                                            <li><strong>Actors:</strong> 
                                                {% for actor in movie.actors.all %}
                                                    {{ actor.name }}{% if not forloop.last %}, {% endif %}
                                                {% endfor %}
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="text-center">
                                        <a href="{% url 'trivia_game:start_game' movie.id %}" 
                                           class="btn btn-primary">
                                            Choose This Movie
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="alert alert-warning">
                            No movies available. Please add some movies first.
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.movie-header {
    cursor: pointer;
    transition: background-color 0.2s;
}

.movie-header:hover {
    background-color: rgba(0, 0, 0, 0.05);
}

.movie-details {
    background-color: #f8f9fa;
    border-radius: 0 0 0.25rem 0.25rem;
}

.movie-info {
    background-color: white;
    padding: 1rem;
    border-radius: 0.25rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.movie-info ul li {
    margin-bottom: 0.5rem;
}

.movie-item {
    border: 1px solid rgba(0, 0, 0, 0.125);
    border-radius: 0.25rem;
}

.movie-item .list-group-item {
    border: none;
    border-radius: 0.25rem 0.25rem 0 0;
}

.movie-details .card-body {
    padding-top: 1rem;
}
</style>

<script>
function toggleMovieDetails(movieId) {
    const detailsElement = document.getElementById(`movie-details-${movieId}`);
    const allDetails = document.querySelectorAll('.movie-details');
    
    // Close all other open details first
    allDetails.forEach(detail => {
        if (detail !== detailsElement && detail.classList.contains('show')) {
            detail.classList.remove('show');
        }
    });
    
    // Toggle the clicked details
    detailsElement.classList.toggle('show');
}
</script>
{% endblock %}