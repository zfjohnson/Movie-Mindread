{% extends 'trivia_game/base.html' %}
{% load static %}

{% block title %}Movie Mindread - Make Your Guess{% endblock %}

{% block content %}
<div class="game-container">
    <div id="game-content">
        <div class="row mb-4">
            <div class="col">
                <h2>Guess the Movie</h2>
                <div class="score-display mb-3">
                    Guesses Remaining: <span id="guessesRemaining">{{ game_state.remaining_guesses }}</span>
                </div>
            </div>
        </div>

        <div class="trivia-section mb-4">
            <h4>Movie Trivia:</h4>
            <div id="triviaList" class="mb-4">
                {% for fact in trivia_facts %}
                    <div class="trivia-box" data-difficulty="{{ fact.difficulty }}">
                        {{ fact.text }}
                    </div>
                {% endfor %}
            </div>
        </div>

        <div class="guess-section">
            <form id="guessForm" method="post" action="{% url 'trivia_game:make_guess' %}">
                {% csrf_token %}
                <div class="input-group mb-3">
                    <input type="text" 
                           id="guessInput" 
                           name="guess"
                           class="form-control guess-input" 
                           placeholder="Enter your movie guess..."
                           autocomplete="off"
                           required>
                    <button class="btn btn-primary" type="submit">
                        <i class="fas fa-paper-plane"></i> Make Guess
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div class="modal fade" id="gameOverModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="gameOverTitle">Game Over</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="gameOverMessage">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="window.location.href='{% url 'trivia_game:index' %}'">
                        Play Again
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.game-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem;
}

.trivia-section {
    background-color: rgba(0, 0, 0, 0.05);
    padding: 1.5rem;
    border-radius: 15px;
}

.trivia-box {
    background-color: white;
    padding: 1rem;
    margin-bottom: 1rem;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    animation: slideIn 0.3s ease-out;
}

.trivia-box[data-difficulty='hard'] {
    border-left: 4px solid #dc3545;
}

.trivia-box[data-difficulty='medium'] {
    border-left: 4px solid #ffc107;
}

.trivia-box[data-difficulty='easy'] {
    border-left: 4px solid #28a745;
}

@keyframes slideIn {
    from {
        transform: translateY(-20px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}
</style>

<script>
document.getElementById('guessForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const guess = formData.get('guess').trim();
    
    if (!guess) return;
    
    fetch("{% url 'trivia_game:make_guess' %}", {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'correct' || data.status === 'game_over') {
            window.location.href = data.redirect;
        } else {
            document.getElementById('guessesRemaining').textContent = 9 - data.num_guesses;
            // Reload page to show new trivia fact
            window.location.reload();
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error submitting guess. Please try again.');
    });
});
</script>
{% endblock %}